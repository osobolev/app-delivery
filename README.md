# Список файлов в папке `root`

- `<app>-client.bat`/`<app>-client.sh` - скрипт запуска приложения
- `<app>_jars.list` - см. ниже
- `<app>_splash.jpg` - splash-скрин для запуска приложения (обновляется на клиенте автоматически)
- `apploader.properties`/`apploader_<profile>.properties` - см. ниже
- `install.properties`/`install_<profile>.properties` - см. ниже
- `index.html` + `install.js` - страница скачивания дистрибутива клиента
- `apploader.jar` - загрузчик приложения
- `checknew.bat`/`checknew.sh` - скрипт обновления `apploader.jar`

# Свойства `<app>_jars.list`

- `corejar` - исполняемые файлы приложения, при обновлении которых требуется перезапуск
- `jar` - исполняемые файлы приложения, скачиваемые с сервера
- `dll` - исполняемые файлы приложения, скачиваемые с сервера
- `localjar` - исполняемые файлы приложения, уже находящиеся на клиенте. 
В значении могут использоваться `${VAR}` или `$VAR` для ссылки на системные свойства/переменные окружения (системные свойства более приоритетны). 
Также могут использоваться `${VAR?}` или `$VAR?` -- в случае отсутствия `VAR` данный исполняемый файл не загружается. 
- `localdll` - аналогично `localjar`
- `file` - файлы приложения, скачиваемые с сервера. 
Есть два особых файла: `tzupdater.jar` и `tzdata.tar.gz`; если они присутствуют, то осуществляется обновление TZDB до указанной в `tzdata.tar.gz` версии.  
- `jre`/`jre64`/`jre.win`/`jre64.win`/`jre.lin`/`jre64.lin` - архивы среды исполнения Java для обновления Java на клиенте. 
`.win` загружается только на Windows, `.lin` загружается только на Linux.
Если присутствует и `jre`, и `jre64`, то из них выбирается вариант, соответствующий ОС клиента.
Если присутствует только `jre64`, то Java обновляется, только если ОС поддерживает 64 битные приложения.
Если присутствует только `jre`, то Java всегда обновляется (поэтому это должна быть либо 32-битная версия, либо если это 64-битная версия, то все клиенты должны поддерживать 64 бита).
- `mainClass` - главный класс приложения

Все свойства, кроме `corejar` и `mainClass` могут предваряться `?` - при этом при невозможности загрузки работа продолжается.

# Файлы конфигурации клиента:

- `apploader.properties`
- `apploader_<profile>.properties`: имеет приоритет, если задан профиль.

## Свойства конфигурации клиента:
- `server.url`
- `ignore.warnings`

# Файлы конфигурации сервера:

- `install.properties`: наследуется всеми профилями.
- `install_<profile>.properties`: имеет приоритет, если задан профиль.

## Свойства конфигурации сервера:
- `inno.dir`: папка, в которой установлен Inno Setup. По умолчанию `%ProgramFiles%\Inno Setup 5`.
- `rar.dir`: папка, в которой установлен RAR. По умолчанию `%ProgramFiles%\WinRAR` для Windows и `/bin`, `/usr/bin` или `/usr/local/bin` для Linux.
- `makeself`: путь к исполняемому файлу makeself. По умолчанию `makeself` или `makeself.sh` в папках `/bin`, `/usr/bin` или `/usr/local/bin`.

- `server.url`: если файлы `apploader.properties` и `apploader_<profile>.properties` отсутствуют, то сгенерировать файл с этим значением `server.url`. По умолчанию берется из адреса в строке браузера.
- `java.dir`: директория, откуда брать Java для дистрибутива клиента. По умолчанию значение свойства `java.home`.
- `java.zip`: zip-архив, откуда брать Java для дистрибутива клиента.
- `client.os`: на какой ОС работает клиент (Windows/Linux). Если это свойство не указано, выводится из имени профиля (в зависимости от того, оканчивается ли на `.win` или на `.lin`). Если не удается определить, то совпадает с ОС сервера.
- `base.name`: базовое имя файла дистрибутива клиента. Расширение будет в зависимости от используемой программы создания дистрибутива. По умолчанию `install`.
- `packers`: разделенный запятыми список программ создания дистрибутива (`inno`, `rar`, `makeself`, `7zsfx`, `7z`, `zip`). По умолчанию список определяется в зависимости от ОС клиента и сервера.

## Доп. требования для программ создания дистрибутива:

Все доп. файлы (`*.iss`, `*.cfg`, `7z.sfx.*`, `*.ico`, `*.png`) должны лежать в папке `root`.

### inno:
Должны присутствовать файлы `client.iss` (имя файла можно изменить заданием свойства сервера `inno.script`) и `common.iss`.

Если присутствуют файлы `<app>.ico` и `uninst_<app>.ico`, то они будут использоваться в качестве иконок приложения.

### rar:
Должен присутствовать файл `sfx.cfg` (имя файла можно изменить заданием свойства сервера `rar.cfg`).

Если присутствует файл `<app>.ico`, то он может использоваться в качестве иконки приложения в `sfx.cfg`.

### makeself:
Должен присутствовать файл `makeself-setup.sh` (имя файла можно изменить заданием свойства сервера `makeself.script`) либо указано свойство сервера `makeself.dir` (в этом случае `makeself` будет просто распаковывать архив в эту папку).

Если присутствует файл `<app>.png`, то он может использоваться в качестве иконки приложения в `makeself-setup.sh`.

### 7zsfx:
Должен присутствовать файл модуля SFX (имя файла можно изменить заданием свойства сервера `7z.sfx.win`/`7z.sfx.lin`, конфигурация модуля задается свойством `7z.sfx.cfg.win`/`7z.sfx.cfg.lin`).
